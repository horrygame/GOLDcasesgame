<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–∂–∏–º —É—á–∏—Ç–µ–ª—è - –ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –†–æ–±–æ—Ç–∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Times New Roman', serif;
        }
        
        body {
            background: linear-gradient(135deg, #3e2723, #5d4037);
            color: #f5e8c8;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        h1 {
            font-size: 36px;
            color: #d7ccc8;
            margin-bottom: 10px;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
            background: rgba(93, 64, 55, 0.8);
            border-radius: 5px;
            overflow: hidden;
        }
        
        .tab {
            padding: 15px 20px;
            cursor: pointer;
            background: rgba(141, 110, 99, 0.6);
            border: none;
            color: #f5e8c8;
            flex: 1;
            font-size: 16px;
        }
        
        .tab.active {
            background: #8d6e63;
            font-weight: bold;
        }
        
        .tab-content {
            display: none;
            background: rgba(61, 43, 31, 0.9);
            padding: 20px;
            border-radius: 5px;
            border: 2px solid #8d6e63;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .button {
            background: linear-gradient(to bottom, #8d6e63, #6d4c41);
            color: #fff;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .button:hover {
            background: linear-gradient(to bottom, #a1887f, #8d6e63);
        }
        
        .button.small {
            padding: 5px 10px;
            font-size: 14px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 8px;
            border: 1px solid #8d6e63;
            border-radius: 3px;
            background: rgba(255, 255, 255, 0.1);
            color: #f5e8c8;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .card {
            background: rgba(93, 64, 55, 0.8);
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #8d6e63;
        }
        
        .card h3 {
            color: #ffd54f;
            margin-bottom: 10px;
        }
        
        .notification {
            background: rgba(255, 213, 79, 0.2);
            border: 1px solid #ffd54f;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        
        .back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(141, 110, 99, 0.8);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ —É—Ä–æ–≤–Ω–µ–π */
        .level-editor-container {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }
        
        .tools-panel {
            width: 200px;
            background: rgba(93, 64, 55, 0.8);
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #8d6e63;
        }
        
        .tool-item {
            padding: 10px;
            margin-bottom: 10px;
            background: rgba(141, 110, 99, 0.6);
            border-radius: 5px;
            cursor: grab;
            text-align: center;
            border: 2px solid transparent;
        }
        
        .tool-item.active {
            border-color: #ffd54f;
        }
        
        .game-grid {
            display: grid;
            grid-template-columns: repeat(12, 40px);
            grid-template-rows: repeat(12, 40px);
            gap: 1px;
            background: rgba(141, 110, 99, 0.3);
            padding: 10px;
            border-radius: 5px;
        }
        
        .grid-cell {
            width: 40px;
            height: 40px;
            background: rgba(121, 85, 72, 0.5);
            border: 1px solid rgba(141, 110, 99, 0.5);
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 20px;
        }
        
        .grid-cell.robot {
            background: rgba(245, 232, 200, 0.8);
        }
        
        .grid-cell.coin {
            background: rgba(255, 213, 79, 0.8);
        }
        
        .grid-cell.enemy {
            background: rgba(239, 83, 80, 0.8);
        }
        
        .grid-cell.obstacle {
            background: rgba(109, 76, 65, 0.8);
        }
        
        .level-info {
            margin-top: 20px;
        }
        
        .grade-item {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }
        
        .level-selector {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #8d6e63;
            padding: 10px;
            border-radius: 5px;
            background: rgba(93, 64, 55, 0.5);
        }
        
        .level-checkbox {
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-button">‚Üê –ù–∞–∑–∞–¥</a>
    
    <div class="container">
        <header>
            <h1>üë®‚Äçüè´ –†–µ–∂–∏–º —É—á–∏—Ç–µ–ª—è</h1>
            <p>–°–æ–∑–¥–∞–≤–∞–π—Ç–µ —É—Ä–æ–∫–∏, —É—Ä–æ–≤–Ω–∏ –∏ —É–ø—Ä–∞–≤–ª—è–π—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å–æ–º –æ–±—É—á–µ–Ω–∏—è</p>
        </header>
        
        <div class="tabs">
            <button class="tab active" onclick="showTab('levels')">–ú–∞—Å—Ç–µ—Ä—Å–∫–∞—è —É—Ä–æ–≤–Ω–µ–π</button>
            <button class="tab" onclick="showTab('lessons')">–ú–æ–∏ —É—Ä–æ–∫–∏</button>
            <button class="tab" onclick="showTab('notifications')">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</button>
        </div>
        
        <!-- –ú–∞—Å—Ç–µ—Ä—Å–∫–∞—è —É—Ä–æ–≤–Ω–µ–π -->
        <div id="levels" class="tab-content active">
            <h2>–ú–∞—Å—Ç–µ—Ä—Å–∫–∞—è —É—Ä–æ–≤–Ω–µ–π</h2>
            <button class="button" onclick="createNewLevel()">+ –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å</button>
            <button class="button" onclick="loadMyLevels()">–ú–æ–∏ —É—Ä–æ–≤–Ω–∏</button>
            
            <div id="level-editor" style="display: none; margin-top: 20px;">
                <h3 id="editor-title">–°–æ–∑–¥–∞–Ω–∏–µ —É—Ä–æ–≤–Ω—è</h3>
                <div class="form-group">
                    <label>–ù–∞–∑–≤–∞–Ω–∏–µ —É—Ä–æ–≤–Ω—è:</label>
                    <input type="text" id="level-title" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ">
                </div>
                <div class="form-group">
                    <label>–û–ø–∏—Å–∞–Ω–∏–µ:</label>
                    <textarea id="level-description" placeholder="–û–ø–∏—à–∏—Ç–µ –∑–∞–¥–∞–Ω–∏–µ —É—Ä–æ–≤–Ω—è"></textarea>
                </div>
                
                <div class="level-editor-container">
                    <div class="tools-panel">
                        <h4>–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:</h4>
                        <div class="tool-item active" data-type="robot" onclick="selectTool('robot')">ü§ñ –†–æ–±–æ—Ç</div>
                        <div class="tool-item" data-type="coin" onclick="selectTool('coin')">ü™ô –ú–æ–Ω–µ—Ç–∞</div>
                        <div class="tool-item" data-type="enemy" onclick="selectTool('enemy')">üëπ –í—Ä–∞–≥</div>
                        <div class="tool-item" data-type="obstacle" onclick="selectTool('obstacle')">üß± –°—Ç–µ–Ω–∞</div>
                        <div class="tool-item" data-type="erase" onclick="selectTool('erase')">üßπ –£–¥–∞–ª–∏—Ç—å</div>
                        
                        <div style="margin-top: 20px;">
                            <button class="button" onclick="clearLevel()">–û—á–∏—Å—Ç–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å</button>
                            <button class="button" onclick="saveLevel()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å</button>
                            <button class="button" onclick="cancelEdit()">–û—Ç–º–µ–Ω–∞</button>
                        </div>
                    </div>
                    
                    <div>
                        <div class="game-grid" id="level-grid">
                            <!-- –°–µ—Ç–∫–∞ 12x12 –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞ —á–µ—Ä–µ–∑ JS -->
                        </div>
                        <div class="level-info">
                            <p>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: 
                                <span id="coins-count">0</span> –º–æ–Ω–µ—Ç, 
                                <span id="enemies-count">0</span> –≤—Ä–∞–≥–æ–≤, 
                                <span id="obstacles-count">0</span> —Å—Ç–µ–Ω
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="grid" id="levels-list">
                <!-- –£—Ä–æ–≤–Ω–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∑–¥–µ—Å—å -->
            </div>
        </div>
        
        <!-- –ú–æ–∏ —É—Ä–æ–∫–∏ -->
        <div id="lessons" class="tab-content">
            <h2>–ú–æ–∏ —É—Ä–æ–∫–∏</h2>
            <button class="button" onclick="showLessonCreator()">+ –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —É—Ä–æ–∫</button>
            
            <div id="lesson-creator" style="display: none; margin-top: 20px;">
                <h3>–°–æ–∑–¥–∞–Ω–∏–µ —É—Ä–æ–∫–∞</h3>
                <div class="form-group">
                    <label>–ù–∞–∑–≤–∞–Ω–∏–µ —É—Ä–æ–∫–∞:</label>
                    <input type="text" id="lesson-title" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ">
                </div>
                <div class="form-group">
                    <label>–û–ø–∏—Å–∞–Ω–∏–µ:</label>
                    <textarea id="lesson-description" placeholder="–û–ø–∏—à–∏—Ç–µ —É—Ä–æ–∫"></textarea>
                </div>
                <div class="form-group">
                    <label>–í—ã–±–µ—Ä–∏—Ç–µ —É—Ä–æ–≤–Ω–∏ –¥–ª—è —É—Ä–æ–∫–∞:</label>
                    <div class="level-selector" id="available-levels">
                        <!-- –£—Ä–æ–≤–Ω–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∑–¥–µ—Å—å -->
                    </div>
                </div>
                <div class="form-group">
                    <label>–ú–∞–≥–∞–∑–∏–Ω –æ—Ü–µ–Ω–æ–∫:</label>
                    <div id="grades-shop">
                        <div class="grade-item">
                            <input type="text" placeholder="–û—Ü–µ–Ω–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: 5)" class="grade-value">
                            <input type="number" placeholder="–¶–µ–Ω–∞ –≤ –º–æ–Ω–µ—Ç–∞—Ö" class="grade-price" min="1" value="10">
                            <button class="button small" onclick="removeGradeItem(this)">‚úï</button>
                        </div>
                    </div>
                    <button class="button" onclick="addGradeItem()">+ –î–æ–±–∞–≤–∏—Ç—å –æ—Ü–µ–Ω–∫—É</button>
                </div>
                <button class="button" onclick="createLesson()">–°–æ–∑–¥–∞—Ç—å —É—Ä–æ–∫</button>
                <button class="button" onclick="cancelLessonCreation()">–û—Ç–º–µ–Ω–∞</button>
            </div>
            
            <div class="grid" id="lessons-list">
                <!-- –£—Ä–æ–∫–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∑–¥–µ—Å—å -->
            </div>
        </div>
        
        <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
        <div id="notifications" class="tab-content">
            <h2>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø–æ–∫—É–ø–∫–∞—Ö</h2>
            <button class="button" onclick="loadNotifications()">–û–±–Ω–æ–≤–∏—Ç—å</button>
            <div id="notifications-list">
                <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∑–¥–µ—Å—å -->
            </div>
        </div>
    </div>

    <script>
        const API_BASE = window.location.hostname === 'localhost' ? 'http://localhost:5000/api' : '/api';
        let currentTeacherId = localStorage.getItem('teacherId');
        let currentTeacherName = localStorage.getItem('teacherName');
        let currentEditingLevel = null;
        let selectedTool = 'robot';
        let levelData = {
            robot: {x: -1, y: -1},
            coins: [],
            enemies: [],
            obstacles: []
        };
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        if (!currentTeacherId) {
            createTeacher();
        } else {
            loadData();
        }
        
        function createTeacher() {
            fetch(`${API_BASE}/users`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    name: `–£—á–∏—Ç–µ–ª—å_${Date.now()}`,
                    type: 'teacher',
                    email: ''
                })
            })
            .then(r => r.json())
            .then(teacher => {
                currentTeacherId = teacher.id;
                currentTeacherName = teacher.name;
                localStorage.setItem('teacherId', currentTeacherId);
                localStorage.setItem('teacherName', currentTeacherName);
                loadData();
            });
        }
        
        function loadData() {
            loadLevels();
            loadLessons();
            loadNotifications();
        }
        
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            document.querySelector(`.tab[onclick="showTab('${tabName}')"]`).classList.add('active');
        }
        
        function loadLevels() {
            fetch(`${API_BASE}/levels`)
                .then(r => r.json())
                .then(levels => {
                    const myLevels = levels.filter(level => level.author === currentTeacherName);
                    const levelsList = document.getElementById('levels-list');
                    levelsList.innerHTML = myLevels.map(level => `
                        <div class="card">
                            <h3>${level.title}</h3>
                            <p>${level.description}</p>
                            <p><small>–ú–æ–Ω–µ—Ç: ${level.coins.length}, –í—Ä–∞–≥–æ–≤: ${level.enemies.length}, –°—Ç–µ–Ω: ${level.obstacles.length}</small></p>
                            <button class="button" onclick="editLevel('${level.id}')">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                            <button class="button" onclick="deleteLevel('${level.id}')">–£–¥–∞–ª–∏—Ç—å</button>
                        </div>
                    `).join('');
                });
        }
        
        function loadMyLevels() {
            showTab('levels');
            loadLevels();
        }
        
        function createNewLevel() {
            currentEditingLevel = null;
            levelData = {
                robot: {x: -1, y: -1},
                coins: [],
                enemies: [],
                obstacles: []
            };
            document.getElementById('editor-title').textContent = '–°–æ–∑–¥–∞–Ω–∏–µ —É—Ä–æ–≤–Ω—è';
            document.getElementById('level-title').value = '';
            document.getElementById('level-description').value = '';
            document.getElementById('level-editor').style.display = 'block';
            initLevelGrid();
            updateStats();
        }
        
        function initLevelGrid() {
            const grid = document.getElementById('level-grid');
            grid.innerHTML = '';
            
            for (let y = 0; y < 12; y++) {
                for (let x = 0; x < 12; x++) {
                    const cell = document.createElement('div');
                    cell.className = 'grid-cell';
                    cell.dataset.x = x;
                    cell.dataset.y = y;
                    cell.addEventListener('click', () => placeObject(x, y));
                    grid.appendChild(cell);
                }
            }
            
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ —É—Ä–æ–≤–Ω—è –µ—Å–ª–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º
            if (currentEditingLevel) {
                loadLevelIntoGrid();
            }
        }
        
        function loadLevelIntoGrid() {
            // –û—á–∏—â–∞–µ–º —Å–µ—Ç–∫—É
            document.querySelectorAll('.grid-cell').forEach(cell => {
                cell.className = 'grid-cell';
                cell.textContent = '';
            });
            
            // –†–∞–∑–º–µ—â–∞–µ–º —Ä–æ–±–æ—Ç–∞
            if (levelData.robot.x !== -1 && levelData.robot.y !== -1) {
                const cell = document.querySelector(`.grid-cell[data-x="${levelData.robot.x}"][data-y="${levelData.robot.y}"]`);
                cell.className = 'grid-cell robot';
                cell.textContent = 'ü§ñ';
            }
            
            // –†–∞–∑–º–µ—â–∞–µ–º –º–æ–Ω–µ—Ç—ã
            levelData.coins.forEach(coin => {
                const cell = document.querySelector(`.grid-cell[data-x="${coin.x}"][data-y="${coin.y}"]`);
                cell.className = 'grid-cell coin';
                cell.textContent = 'ü™ô';
            });
            
            // –†–∞–∑–º–µ—â–∞–µ–º –≤—Ä–∞–≥–æ–≤
            levelData.enemies.forEach(enemy => {
                const cell = document.querySelector(`.grid-cell[data-x="${enemy.x}"][data-y="${enemy.y}"]`);
                cell.className = 'grid-cell enemy';
                cell.textContent = 'üëπ';
            });
            
            // –†–∞–∑–º–µ—â–∞–µ–º —Å—Ç–µ–Ω—ã
            levelData.obstacles.forEach(obstacle => {
                const cell = document.querySelector(`.grid-cell[data-x="${obstacle.x}"][data-y="${obstacle.y}"]`);
                cell.className = 'grid-cell obstacle';
                cell.textContent = 'üß±';
            });
        }
        
        function selectTool(tool) {
            selectedTool = tool;
            document.querySelectorAll('.tool-item').forEach(item => item.classList.remove('active'));
            document.querySelector(`.tool-item[data-type="${tool}"]`).classList.add('active');
        }
        
        function placeObject(x, y) {
            const cell = document.querySelector(`.grid-cell[data-x="${x}"][data-y="${y}"]`);
            
            if (selectedTool === 'erase') {
                clearCell(x, y);
            } else if (selectedTool === 'robot') {
                // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Ä–æ–±–æ—Ç–∞
                if (levelData.robot.x !== -1 && levelData.robot.y !== -1) {
                    clearCell(levelData.robot.x, levelData.robot.y);
                }
                levelData.robot = {x, y};
                cell.className = 'grid-cell robot';
                cell.textContent = 'ü§ñ';
            } else if (selectedTool === 'coin') {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ—Ç –ª–∏ —É–∂–µ –æ–±—ä–µ–∫—Ç–∞ –Ω–∞ —ç—Ç–æ–π –∫–ª–µ—Ç–∫–µ
                if (!isCellOccupied(x, y)) {
                    levelData.coins.push({x, y});
                    cell.className = 'grid-cell coin';
                    cell.textContent = 'ü™ô';
                }
            } else if (selectedTool === 'enemy') {
                if (!isCellOccupied(x, y)) {
                    levelData.enemies.push({x, y});
                    cell.className = 'grid-cell enemy';
                    cell.textContent = 'üëπ';
                }
            } else if (selectedTool === 'obstacle') {
                if (!isCellOccupied(x, y)) {
                    levelData.obstacles.push({x, y});
                    cell.className = 'grid-cell obstacle';
                    cell.textContent = 'üß±';
                }
            }
            
            updateStats();
        }
        
        function isCellOccupied(x, y) {
            if (levelData.robot.x === x && levelData.robot.y === y) return true;
            if (levelData.coins.some(coin => coin.x === x && coin.y === y)) return true;
            if (levelData.enemies.some(enemy => enemy.x === x && enemy.y === y)) return true;
            if (levelData.obstacles.some(obstacle => obstacle.x === x && obstacle.y === y)) return true;
            return false;
        }
        
        function clearCell(x, y) {
            const cell = document.querySelector(`.grid-cell[data-x="${x}"][data-y="${y}"]`);
            cell.className = 'grid-cell';
            cell.textContent = '';
            
            // –£–¥–∞–ª—è–µ–º –∏–∑ –¥–∞–Ω–Ω—ã—Ö
            if (levelData.robot.x === x && levelData.robot.y === y) {
                levelData.robot = {x: -1, y: -1};
            }
            levelData.coins = levelData.coins.filter(coin => !(coin.x === x && coin.y === y));
            levelData.enemies = levelData.enemies.filter(enemy => !(enemy.x === x && enemy.y === y));
            levelData.obstacles = levelData.obstacles.filter(obstacle => !(obstacle.x === x && obstacle.y === y));
            
            updateStats();
        }
        
        function clearLevel() {
            if (confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤–µ—Å—å —É—Ä–æ–≤–µ–Ω—å?')) {
                levelData = {
                    robot: {x: -1, y: -1},
                    coins: [],
                    enemies: [],
                    obstacles: []
                };
                initLevelGrid();
                updateStats();
            }
        }
        
        function updateStats() {
            document.getElementById('coins-count').textContent = levelData.coins.length;
            document.getElementById('enemies-count').textContent = levelData.enemies.length;
            document.getElementById('obstacles-count').textContent = levelData.obstacles.length;
        }
        
        function saveLevel() {
            const title = document.getElementById('level-title').value;
            const description = document.getElementById('level-description').value;
            
            if (!title || !description) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ –æ–ø–∏—Å–∞–Ω–∏–µ —É—Ä–æ–≤–Ω—è');
                return;
            }
            
            if (levelData.robot.x === -1) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Ä–∞–∑–º–µ—Å—Ç–∏—Ç–µ —Ä–æ–±–æ—Ç–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ');
                return;
            }
            
            if (levelData.coins.length === 0) {
                alert('–î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –º–æ–Ω–µ—Ç—É –Ω–∞ —É—Ä–æ–≤–µ–Ω—å');
                return;
            }
            
            const level = {
                title,
                description,
                author: currentTeacherName,
                robot: levelData.robot,
                coins: levelData.coins,
                enemies: levelData.enemies,
                obstacles: levelData.obstacles,
                is_public: false
            };
            
            const url = currentEditingLevel ? 
                `${API_BASE}/levels/${currentEditingLevel}` : 
                `${API_BASE}/levels`;
            
            const method = currentEditingLevel ? 'PUT' : 'POST';
            
            fetch(url, {
                method,
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(level)
            })
            .then(r => r.json())
            .then(() => {
                alert(currentEditingLevel ? '–£—Ä–æ–≤–µ–Ω—å –æ–±–Ω–æ–≤–ª–µ–Ω!' : '–£—Ä–æ–≤–µ–Ω—å —Å–æ–∑–¥–∞–Ω!');
                document.getElementById('level-editor').style.display = 'none';
                loadLevels();
            });
        }
        
        function editLevel(levelId) {
            fetch(`${API_BASE}/levels`)
                .then(r => r.json())
                .then(levels => {
                    const level = levels.find(l => l.id === levelId);
                    if (level) {
                        currentEditingLevel = levelId;
                        levelData = {
                            robot: level.robot,
                            coins: level.coins,
                            enemies: level.enemies,
                            obstacles: level.obstacles
                        };
                        document.getElementById('editor-title').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Ä–æ–≤–Ω—è';
                        document.getElementById('level-title').value = level.title;
                        document.getElementById('level-description').value = level.description;
                        document.getElementById('level-editor').style.display = 'block';
                        initLevelGrid();
                        updateStats();
                    }
                });
        }
        
        function deleteLevel(levelId) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —É—Ä–æ–≤–µ–Ω—å?')) {
                fetch(`${API_BASE}/levels`)
                    .then(r => r.json())
                    .then(levels => {
                        const updatedLevels = levels.filter(l => l.id !== levelId);
                        // –ó–¥–µ—Å—å –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å —Ñ–∞–π–ª levels.json
                        // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å endpoint –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
                        alert('–§—É–Ω–∫—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ –ø–æ–ª–Ω–æ–π –≤–µ—Ä—Å–∏–∏');
                        loadLevels();
                    });
            }
        }
        
        function cancelEdit() {
            document.getElementById('level-editor').style.display = 'none';
        }
        
        function showLessonCreator() {
            document.getElementById('lesson-creator').style.display = 'block';
            loadAvailableLevels();
        }
        
        function loadAvailableLevels() {
            fetch(`${API_BASE}/levels`)
                .then(r => r.json())
                .then(levels => {
                    const myLevels = levels.filter(level => level.author === currentTeacherName);
                    const systemLevels = levels.filter(level => level.author === 'system');
                    const availableLevels = document.getElementById('available-levels');
                    
                    let html = '<h4>–ú–æ–∏ —É—Ä–æ–≤–Ω–∏:</h4>';
                    if (myLevels.length > 0) {
                        html += myLevels.map(level => `
                            <div class="level-checkbox">
                                <input type="checkbox" id="level-${level.id}" value="${level.id}">
                                <label for="level-${level.id}">${level.title}</label>
                            </div>
                        `).join('');
                    } else {
                        html += '<p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —É—Ä–æ–≤–Ω–µ–π</p>';
                    }
                    
                    html += '<h4 style="margin-top: 20px;">–°–∏—Å—Ç–µ–º–Ω—ã–µ —É—Ä–æ–≤–Ω–∏:</h4>';
                    html += systemLevels.map(level => `
                        <div class="level-checkbox">
                            <input type="checkbox" id="level-${level.id}" value="${level.id}">
                            <label for="level-${level.id}">${level.title}</label>
                        </div>
                    `).join('');
                    
                    availableLevels.innerHTML = html;
                });
        }
        
        function addGradeItem() {
            const shop = document.getElementById('grades-shop');
            shop.innerHTML += `
                <div class="grade-item">
                    <input type="text" placeholder="–û—Ü–µ–Ω–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: 5)" class="grade-value">
                    <input type="number" placeholder="–¶–µ–Ω–∞ –≤ –º–æ–Ω–µ—Ç–∞—Ö" class="grade-price" min="1" value="10">
                    <button class="button small" onclick="removeGradeItem(this)">‚úï</button>
                </div>
            `;
        }
        
        function removeGradeItem(button) {
            if (document.querySelectorAll('.grade-item').length > 1) {
                button.parentElement.remove();
            }
        }
        
        function createLesson() {
            const selectedLevels = Array.from(document.querySelectorAll('#available-levels input:checked'))
                .map(cb => cb.value);
            
            if (selectedLevels.length === 0) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —É—Ä–æ–≤–µ–Ω—å –¥–ª—è —É—Ä–æ–∫–∞');
                return;
            }
            
            const gradeItems = Array.from(document.querySelectorAll('.grade-item'))
                .map(item => ({
                    id: Math.random().toString(36).substr(2, 9),
                    grade: item.querySelector('.grade-value').value,
                    price: parseInt(item.querySelector('.grade-price').value)
                }))
                .filter(item => item.grade && item.price);
            
            if (gradeItems.length === 0) {
                alert('–î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –æ—Ü–µ–Ω–∫—É –≤ –º–∞–≥–∞–∑–∏–Ω');
                return;
            }
            
            const lesson = {
                title: document.getElementById('lesson-title').value,
                description: document.getElementById('lesson-description').value,
                teacher_id: currentTeacherId,
                levels: selectedLevels,
                grades_shop: gradeItems
            };
            
            fetch(`${API_BASE}/lessons`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(lesson)
            })
            .then(r => r.json())
            .then(createdLesson => {
                alert(`–£—Ä–æ–∫ —Å–æ–∑–¥–∞–Ω! –ö–æ–¥ —É—Ä–æ–∫–∞ –¥–ª—è —É—á–µ–Ω–∏–∫–æ–≤: ${createdLesson.code}`);
                document.getElementById('lesson-creator').style.display = 'none';
                loadLessons();
            });
        }
        
        function cancelLessonCreation() {
            document.getElementById('lesson-creator').style.display = 'none';
        }
        
        function loadLessons() {
            fetch(`${API_BASE}/lessons?teacher_id=${currentTeacherId}`)
                .then(r => r.json())
                .then(lessons => {
                    const lessonsList = document.getElementById('lessons-list');
                    lessonsList.innerHTML = lessons.map(lesson => `
                        <div class="card">
                            <h3>${lesson.title}</h3>
                            <p>${lesson.description}</p>
                            <p><strong>–ö–æ–¥ —É—Ä–æ–∫–∞: ${lesson.code}</strong></p>
                            <p>–£—á–µ–Ω–∏–∫–æ–≤: ${lesson.students.length}</p>
                            <p>–£—Ä–æ–≤–Ω–µ–π: ${lesson.levels.length}</p>
                            <p>–û—Ü–µ–Ω–æ–∫ –≤ –º–∞–≥–∞–∑–∏–Ω–µ: ${lesson.grades_shop.length}</p>
                            <button class="button" onclick="viewLessonDetails('${lesson.id}')">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
                        </div>
                    `).join('');
                });
        }
        
        function viewLessonDetails(lessonId) {
            fetch(`${API_BASE}/lessons/${lessonId}`)
                .then(r => r.json())
                .then(lesson => {
                    let message = `–£—Ä–æ–∫: ${lesson.title}\n\n`;
                    message += `–ö–æ–¥: ${lesson.code}\n`;
                    message += `–£—á–µ–Ω–∏–∫–æ–≤: ${lesson.students.length}\n`;
                    message += `–£—Ä–æ–≤–Ω–µ–π: ${lesson.levels.length}\n\n`;
                    message += '–£—á–µ–Ω–∏–∫–∏:\n';
                    lesson.students.forEach(student => {
                        message += `- ${student.student_name}: ${student.coins} –º–æ–Ω–µ—Ç, ${student.completed_levels.length} —É—Ä–æ–≤–Ω–µ–π\n`;
                    });
                    alert(message);
                });
        }
        
        function loadNotifications() {
            fetch(`${API_BASE}/notifications/${currentTeacherId}`)
                .then(r => r.json())
                .then(notifications => {
                    const notificationsList = document.getElementById('notifications-list');
                    notificationsList.innerHTML = notifications.length ? 
                        notifications.map(notif => `
                            <div class="notification">
                                <strong>${notif.student_name}</strong> –∫—É–ø–∏–ª(–∞) –æ—Ü–µ–Ω–∫—É <strong>${notif.grade}</strong> 
                                –∑–∞ ${notif.price} –º–æ–Ω–µ—Ç
                                <br><small>${new Date(notif.purchased_at).toLocaleString()}</small>
                            </div>
                        `).join('') :
                        '<p>–ù–µ—Ç –Ω–æ–≤—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</p>';
                });
        }
    </script>
</body>
</html>
