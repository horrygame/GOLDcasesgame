<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–∂–∏–º —É—á–∏—Ç–µ–ª—è - –ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –†–æ–±–æ—Ç–∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Times New Roman', serif;
        }
        
        body {
            background: linear-gradient(135deg, #3e2723, #5d4037);
            color: #f5e8c8;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        h1 {
            font-size: 36px;
            color: #d7ccc8;
            margin-bottom: 10px;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
            background: rgba(93, 64, 55, 0.8);
            border-radius: 5px;
            overflow: hidden;
        }
        
        .tab {
            padding: 15px 20px;
            cursor: pointer;
            background: rgba(141, 110, 99, 0.6);
            border: none;
            color: #f5e8c8;
            flex: 1;
            font-size: 16px;
        }
        
        .tab.active {
            background: #8d6e63;
            font-weight: bold;
        }
        
        .tab-content {
            display: none;
            background: rgba(61, 43, 31, 0.9);
            padding: 20px;
            border-radius: 5px;
            border: 2px solid #8d6e63;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .button {
            background: linear-gradient(to bottom, #8d6e63, #6d4c41);
            color: #fff;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .button:hover {
            background: linear-gradient(to bottom, #a1887f, #8d6e63);
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 8px;
            border: 1px solid #8d6e63;
            border-radius: 3px;
            background: rgba(255, 255, 255, 0.1);
            color: #f5e8c8;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .card {
            background: rgba(93, 64, 55, 0.8);
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #8d6e63;
        }
        
        .card h3 {
            color: #ffd54f;
            margin-bottom: 10px;
        }
        
        .notification {
            background: rgba(255, 213, 79, 0.2);
            border: 1px solid #ffd54f;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        
        .back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(141, 110, 99, 0.8);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-button">‚Üê –ù–∞–∑–∞–¥</a>
    
    <div class="container">
        <header>
            <h1>üë®‚Äçüè´ –†–µ–∂–∏–º —É—á–∏—Ç–µ–ª—è</h1>
            <p>–°–æ–∑–¥–∞–≤–∞–π—Ç–µ —É—Ä–æ–∫–∏, —É—Ä–æ–≤–Ω–∏ –∏ —É–ø—Ä–∞–≤–ª—è–π—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å–æ–º –æ–±—É—á–µ–Ω–∏—è</p>
        </header>
        
        <div class="tabs">
            <button class="tab active" onclick="showTab('levels')">–ú–∞—Å—Ç–µ—Ä—Å–∫–∞—è —É—Ä–æ–≤–Ω–µ–π</button>
            <button class="tab" onclick="showTab('lessons')">–ú–æ–∏ —É—Ä–æ–∫–∏</button>
            <button class="tab" onclick="showTab('notifications')">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</button>
        </div>
        
        <!-- –ú–∞—Å—Ç–µ—Ä—Å–∫–∞—è —É—Ä–æ–≤–Ω–µ–π -->
        <div id="levels" class="tab-content active">
            <h2>–ú–∞—Å—Ç–µ—Ä—Å–∫–∞—è —É—Ä–æ–≤–Ω–µ–π</h2>
            <button class="button" onclick="showLevelEditor()">+ –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å</button>
            
            <div id="level-editor" style="display: none; margin-top: 20px;">
                <h3>–°–æ–∑–¥–∞–Ω–∏–µ —É—Ä–æ–≤–Ω—è</h3>
                <div class="form-group">
                    <label>–ù–∞–∑–≤–∞–Ω–∏–µ —É—Ä–æ–≤–Ω—è:</label>
                    <input type="text" id="level-title" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ">
                </div>
                <div class="form-group">
                    <label>–û–ø–∏—Å–∞–Ω–∏–µ:</label>
                    <textarea id="level-description" placeholder="–û–ø–∏—à–∏—Ç–µ –∑–∞–¥–∞–Ω–∏–µ —É—Ä–æ–≤–Ω—è"></textarea>
                </div>
                <div class="form-group">
                    <label>–ü–æ–∑–∏—Ü–∏—è —Ä–æ–±–æ—Ç–∞ (X, Y):</label>
                    <input type="number" id="robot-x" placeholder="X" min="0" max="23" value="2">
                    <input type="number" id="robot-y" placeholder="Y" min="0" max="23" value="4">
                </div>
                <button class="button" onclick="saveLevel()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å</button>
            </div>
            
            <div class="grid" id="levels-list">
                <!-- –£—Ä–æ–≤–Ω–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∑–¥–µ—Å—å -->
            </div>
        </div>
        
        <!-- –ú–æ–∏ —É—Ä–æ–∫–∏ -->
        <div id="lessons" class="tab-content">
            <h2>–ú–æ–∏ —É—Ä–æ–∫–∏</h2>
            <button class="button" onclick="showLessonCreator()">+ –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —É—Ä–æ–∫</button>
            
            <div id="lesson-creator" style="display: none; margin-top: 20px;">
                <h3>–°–æ–∑–¥–∞–Ω–∏–µ —É—Ä–æ–∫–∞</h3>
                <div class="form-group">
                    <label>–ù–∞–∑–≤–∞–Ω–∏–µ —É—Ä–æ–∫–∞:</label>
                    <input type="text" id="lesson-title" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ">
                </div>
                <div class="form-group">
                    <label>–û–ø–∏—Å–∞–Ω–∏–µ:</label>
                    <textarea id="lesson-description" placeholder="–û–ø–∏—à–∏—Ç–µ —É—Ä–æ–∫"></textarea>
                </div>
                <div class="form-group">
                    <label>–í—ã–±–µ—Ä–∏—Ç–µ —É—Ä–æ–≤–Ω–∏ –¥–ª—è —É—Ä–æ–∫–∞:</label>
                    <div id="available-levels"></div>
                </div>
                <div class="form-group">
                    <label>–ú–∞–≥–∞–∑–∏–Ω –æ—Ü–µ–Ω–æ–∫:</label>
                    <div id="grades-shop">
                        <div class="grade-item">
                            <input type="text" placeholder="–û—Ü–µ–Ω–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: 5)" class="grade-value">
                            <input type="number" placeholder="–¶–µ–Ω–∞ –≤ –º–æ–Ω–µ—Ç–∞—Ö" class="grade-price" min="1">
                            <button class="button" onclick="removeGradeItem(this)">‚úï</button>
                        </div>
                    </div>
                    <button class="button" onclick="addGradeItem()">+ –î–æ–±–∞–≤–∏—Ç—å –æ—Ü–µ–Ω–∫—É</button>
                </div>
                <button class="button" onclick="createLesson()">–°–æ–∑–¥–∞—Ç—å —É—Ä–æ–∫</button>
            </div>
            
            <div class="grid" id="lessons-list">
                <!-- –£—Ä–æ–∫–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∑–¥–µ—Å—å -->
            </div>
        </div>
        
        <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
        <div id="notifications" class="tab-content">
            <h2>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø–æ–∫—É–ø–∫–∞—Ö</h2>
            <button class="button" onclick="loadNotifications()">–û–±–Ω–æ–≤–∏—Ç—å</button>
            <div id="notifications-list">
                <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∑–¥–µ—Å—å -->
            </div>
        </div>
    </div>

    <script>
        const API_BASE = window.location.hostname === 'localhost' ? 'http://localhost:5000/api' : '/api';
        let currentTeacherId = localStorage.getItem('teacherId');
        
        // –ï—Å–ª–∏ —É—á–∏—Ç–µ–ª—å –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω, —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–≥–æ
        if (!currentTeacherId) {
            fetch(`${API_BASE}/users`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    name: `–£—á–∏—Ç–µ–ª—å_${Date.now()}`,
                    type: 'teacher',
                    email: ''
                })
            })
            .then(r => r.json())
            .then(teacher => {
                currentTeacherId = teacher.id;
                localStorage.setItem('teacherId', currentTeacherId);
                localStorage.setItem('teacherName', teacher.name);
                loadData();
            });
        } else {
            loadData();
        }
        
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            document.querySelector(`.tab[onclick="showTab('${tabName}')"]`).classList.add('active');
        }
        
        function loadData() {
            loadLevels();
            loadLessons();
            loadNotifications();
        }
        
        function loadLevels() {
            fetch(`${API_BASE}/levels`)
                .then(r => r.json())
                .then(levels => {
                    const levelsList = document.getElementById('levels-list');
                    levelsList.innerHTML = levels.map(level => `
                        <div class="card">
                            <h3>${level.title}</h3>
                            <p>${level.description}</p>
                            <p><small>–ê–≤—Ç–æ—Ä: ${level.author}</small></p>
                            <p><small>–ú–æ–Ω–µ—Ç: ${level.coins.length}</small></p>
                            <button class="button" onclick="editLevel('${level.id}')">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                        </div>
                    `).join('');
                });
        }
        
        function loadLessons() {
            fetch(`${API_BASE}/lessons?teacher_id=${currentTeacherId}`)
                .then(r => r.json())
                .then(lessons => {
                    const lessonsList = document.getElementById('lessons-list');
                    lessonsList.innerHTML = lessons.map(lesson => `
                        <div class="card">
                            <h3>${lesson.title}</h3>
                            <p>${lesson.description}</p>
                            <p><strong>–ö–æ–¥ —É—Ä–æ–∫–∞: ${lesson.code}</strong></p>
                            <p>–£—á–µ–Ω–∏–∫–æ–≤: ${lesson.students.length}</p>
                            <p>–£—Ä–æ–≤–Ω–µ–π: ${lesson.levels.length}</p>
                            <button class="button" onclick="viewLesson('${lesson.id}')">–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å</button>
                        </div>
                    `).join('');
                });
        }
        
        function loadNotifications() {
            fetch(`${API_BASE}/notifications/${currentTeacherId}`)
                .then(r => r.json())
                .then(notifications => {
                    const notificationsList = document.getElementById('notifications-list');
                    notificationsList.innerHTML = notifications.length ? 
                        notifications.map(notif => `
                            <div class="notification">
                                <strong>${notif.student_name}</strong> –∫—É–ø–∏–ª(–∞) –æ—Ü–µ–Ω–∫—É <strong>${notif.grade}</strong> 
                                –∑–∞ ${notif.price} –º–æ–Ω–µ—Ç
                                <br><small>${new Date(notif.purchased_at).toLocaleString()}</small>
                            </div>
                        `).join('') :
                        '<p>–ù–µ—Ç –Ω–æ–≤—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</p>';
                });
        }
        
        function showLevelEditor() {
            document.getElementById('level-editor').style.display = 'block';
        }
        
        function saveLevel() {
            const level = {
                title: document.getElementById('level-title').value,
                description: document.getElementById('level-description').value,
                author: localStorage.getItem('teacherName'),
                robot: {x: parseInt(document.getElementById('robot-x').value), y: parseInt(document.getElementById('robot-y').value)},
                coins: [{x: 5, y: 2}], // –ü—Ä–∏–º–µ—Ä –º–æ–Ω–µ—Ç—ã
                enemies: [],
                obstacles: [],
                is_public: true
            };
            
            fetch(`${API_BASE}/levels`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(level)
            })
            .then(r => r.json())
            .then(() => {
                alert('–£—Ä–æ–≤–µ–Ω—å —Å–æ–∑–¥–∞–Ω!');
                document.getElementById('level-editor').style.display = 'none';
                loadLevels();
            });
        }
        
        function showLessonCreator() {
            document.getElementById('lesson-creator').style.display = 'block';
            loadAvailableLevels();
        }
        
        function loadAvailableLevels() {
            fetch(`${API_BASE}/levels`)
                .then(r => r.json())
                .then(levels => {
                    const availableLevels = document.getElementById('available-levels');
                    availableLevels.innerHTML = levels.map(level => `
                        <div>
                            <input type="checkbox" id="level-${level.id}" value="${level.id}">
                            <label for="level-${level.id}">${level.title}</label>
                        </div>
                    `).join('');
                });
        }
        
        function addGradeItem() {
            const shop = document.getElementById('grades-shop');
            shop.innerHTML += `
                <div class="grade-item">
                    <input type="text" placeholder="–û—Ü–µ–Ω–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: 5)" class="grade-value">
                    <input type="number" placeholder="–¶–µ–Ω–∞ –≤ –º–æ–Ω–µ—Ç–∞—Ö" class="grade-price" min="1">
                    <button class="button" onclick="removeGradeItem(this)">‚úï</button>
                </div>
            `;
        }
        
        function removeGradeItem(button) {
            button.parentElement.remove();
        }
        
        function createLesson() {
            const selectedLevels = Array.from(document.querySelectorAll('#available-levels input:checked'))
                .map(cb => cb.value);
            
            const gradeItems = Array.from(document.querySelectorAll('.grade-item'))
                .map(item => ({
                    id: Math.random().toString(36).substr(2, 9),
                    grade: item.querySelector('.grade-value').value,
                    price: parseInt(item.querySelector('.grade-price').value)
                }))
                .filter(item => item.grade && item.price);
            
            const lesson = {
                title: document.getElementById('lesson-title').value,
                description: document.getElementById('lesson-description').value,
                teacher_id: currentTeacherId,
                levels: selectedLevels,
                grades_shop: gradeItems
            };
            
            fetch(`${API_BASE}/lessons`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(lesson)
            })
            .then(r => r.json())
            .then(() => {
                alert('–£—Ä–æ–∫ —Å–æ–∑–¥–∞–Ω! –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –∫–æ–¥–æ–º —É—Ä–æ–∫–∞ —Å —É—á–µ–Ω–∏–∫–∞–º–∏');
                document.getElementById('lesson-creator').style.display = 'none';
                loadLessons();
            });
        }
        
        function viewLesson(lessonId) {
            alert(`–§—É–Ω–∫—Ü–∏—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —É—Ä–æ–∫–∞ ${lessonId} –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ`);
        }
        
        function editLevel(levelId) {
            alert(`–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Ä–æ–≤–Ω—è ${levelId} –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ`);
        }
    </script>
</body>
</html>
