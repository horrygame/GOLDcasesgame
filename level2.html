<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–£—Ä–æ–≤–µ–Ω—å 2 - –ë–∏—Ç–≤–∞ –ö—Ä–µ–ø–æ—Å—Ç–µ–π</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Times New Roman', serif;
        }
        
        body {
            background: linear-gradient(135deg, #3e2723, #5d4037);
            color: #f5e8c8;
            height: 100vh;
            overflow: hidden;
        }
        
        .level-container {
            display: flex;
            height: 100vh;
        }
        
        .game-area {
            flex: 1;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        #game-canvas {
            border: 4px solid #8d6e63;
            border-radius: 5px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
        }
        
        .info-panel {
            width: 400px;
            background: rgba(93, 64, 55, 0.9);
            padding: 20px;
            border-left: 2px solid #8d6e63;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .button {
            background: linear-gradient(to bottom, #8d6e63, #6d4c41);
            color: #fff;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
            text-align: center;
            border: 2px solid #5d4037;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7);
            font-weight: bold;
        }
        
        .button:hover {
            background: linear-gradient(to bottom, #a1887f, #8d6e63);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.6);
        }
        
        .objective {
            background: rgba(121, 85, 72, 0.8);
            padding: 15px;
            border-radius: 5px;
        }
        
        .commands-help {
            background: rgba(121, 85, 72, 0.8);
            padding: 15px;
            border-radius: 5px;
            flex: 1;
        }
        
        .level-buttons {
            display: flex;
            gap: 10px;
        }
        
        .tutorial-text {
            background: rgba(245, 232, 200, 0.1);
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #ffd54f;
        }
        
        #code-editor {
            width: 100%;
            height: 200px;
            background: #5d4037;
            color: #f5e8c8;
            border: 1px solid #8d6e63;
            border-radius: 5px;
            padding: 10px;
            font-family: monospace;
            font-size: 14px;
            resize: none;
        }
        
        h2 {
            color: #d7ccc8;
            margin-bottom: 10px;
        }
        
        h3 {
            color: #ffd54f;
            margin-bottom: 10px;
        }
        
        code {
            background: rgba(0, 0, 0, 0.3);
            padding: 2px 4px;
            border-radius: 3px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="level-container">
        <div class="game-area">
            <canvas id="game-canvas" width="800" height="800"></canvas>
        </div>
        
        <div class="info-panel">
            <button class="button" onclick="window.location.href='levels.html'">‚Üê –ù–∞–∑–∞–¥ –∫ —É—Ä–æ–≤–Ω—è–º</button>
            
            <h2>–£—Ä–æ–≤–µ–Ω—å 2: –ê—Ç–∞–∫–∞ –≤—Ä–∞–≥–æ–≤</h2>
            
            <div class="tutorial-text">
                <h3>–ù–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞: attack()</h3>
                <p>–¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –∞—Ç–∞–∫–æ–≤–∞—Ç—å –≤—Ä–∞–≥–æ–≤! –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É <code>attack()</code> –∫–æ–≥–¥–∞ –≤—Ä–∞–≥ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Ä—è–¥–æ–º.</p>
                <p><strong>–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:</strong></p>
                <ul>
                    <li><code>move_forward(distance)</code> - –¥–≤–∏–∂–µ–Ω–∏–µ –≤–ø–µ—Ä–µ–¥</li>
                    <li><code>move_backward(distance)</code> - –¥–≤–∏–∂–µ–Ω–∏–µ –Ω–∞–∑–∞–¥</li>
                    <li><code>move_left(distance)</code> - –¥–≤–∏–∂–µ–Ω–∏–µ –≤–ª–µ–≤–æ</li>
                    <li><code>move_right(distance)</code> - –¥–≤–∏–∂–µ–Ω–∏–µ –≤–ø—Ä–∞–≤–æ</li>
                    <li><code>attack()</code> - –∞—Ç–∞–∫–æ–≤–∞—Ç—å –±–ª–∏–∂–∞–π—à–µ–≥–æ –≤—Ä–∞–≥–∞</li>
                </ul>
            </div>

            <div class="objective">
                <h3>üéØ –ó–∞–¥–∞—á–∞ —É—Ä–æ–≤–Ω—è</h3>
                <p>–ü–æ–±–µ–¥–∏—Ç—å 3 –≤—Ä–∞–≥–æ–≤ –∏—Å–ø–æ–ª—å–∑—É—è –∫–æ–º–∞–Ω–¥—É attack()</p>
                <p id="level-progress">–û—Å—Ç–∞–ª–æ—Å—å –≤—Ä–∞–≥–æ–≤: 3</p>
            </div>

            <div class="commands-help">
                <h3>üìù –í–∞—à–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∞</h3>
                <textarea id="code-editor" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–º–∞–Ω–¥—ã –∑–¥–µ—Å—å...&#10;–ü—Ä–∏–º–µ—Ä:&#10;move_forward(100)&#10;attack()&#10;move_right(50)&#10;attack()"></textarea>
            </div>

            <div class="level-buttons">
                <button class="button" id="run-code">–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É</button>
                <button class="button" id="reset-level">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');

        let unit = {
            x: 100,
            y: 100,
            isMoving: false,
            commands: [],
            attackRange: 80
        };

        let enemies = [
            { x: 300, y: 200, health: 100, alive: true },
            { x: 500, y: 300, health: 100, alive: true },
            { x: 200, y: 500, health: 100, alive: true }
        ];

        let enemiesDefeated = 0;

        function renderLevel() {
            // –û—á–∏—Å—Ç–∫–∞ canvas
            ctx.fillStyle = '#7cb342';
            ctx.fillRect(0, 0, 800, 800);

            // –¢–µ–∫—Å—Ç—É—Ä–∞ —Ç—Ä–∞–≤—ã
            ctx.fillStyle = '#689f38';
            for (let i = 0; i < 800; i += 20) {
                for (let j = 0; j < 800; j += 20) {
                    if ((i + j) % 40 === 0) {
                        ctx.fillRect(i, j, 10, 10);
                    }
                }
            }

            // –í—Ä–∞–≥–∏
            enemies.forEach(enemy => {
                if (enemy.alive) {
                    ctx.fillStyle = '#ef5350';
                    ctx.beginPath();
                    ctx.arc(enemy.x, enemy.y, 25, 0, Math.PI * 2);
                    ctx.fill();
                    
                    ctx.fillStyle = '#5d4037';
                    ctx.beginPath();
                    ctx.arc(enemy.x, enemy.y, 20, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // –ü–æ–ª–æ—Å–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
                    ctx.fillStyle = '#5d4037';
                    ctx.fillRect(enemy.x - 25, enemy.y - 40, 50, 8);
                    ctx.fillStyle = '#4caf50';
                    ctx.fillRect(enemy.x - 25, enemy.y - 40, 50 * (enemy.health / 100), 8);
                }
            });

            // –Æ–Ω–∏—Ç
            ctx.fillStyle = '#8d6e63';
            ctx.beginPath();
            ctx.arc(unit.x, unit.y, 25, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.fillStyle = '#5d4037';
            ctx.beginPath();
            ctx.arc(unit.x, unit.y, 20, 0, Math.PI * 2);
            ctx.fill();

            // –†–∞–¥–∏—É—Å –∞—Ç–∞–∫–∏
            ctx.strokeStyle = 'rgba(239, 83, 80, 0.3)';
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.arc(unit.x, unit.y, unit.attackRange, 0, Math.PI * 2);
            ctx.stroke();
            ctx.setLineDash([]);

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
            const remainingEnemies = enemies.filter(e => e.alive).length;
            document.getElementById('level-progress').textContent = `–û—Å—Ç–∞–ª–æ—Å—å –≤—Ä–∞–≥–æ–≤: ${remainingEnemies}`;

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è
            if (remainingEnemies === 0 && !unit.isMoving) {
                completeLevel();
            }
        }

        function executeCommands() {
            const code = document.getElementById('code-editor').value;
            const commands = code.split('\n').filter(cmd => cmd.trim());
            
            unit.commands = commands;
            unit.isMoving = true;
            
            let index = 0;
            
            function executeNextCommand() {
                if (index >= unit.commands.length) {
                    unit.isMoving = false;
                    return;
                }
                
                const command = unit.commands[index].trim();
                
                if (command.startsWith('move_forward(')) {
                    const match = command.match(/move_forward\((\d+)\)/);
                    if (match) {
                        unit.y -= parseInt(match[1]);
                    }
                }
                else if (command.startsWith('move_backward(')) {
                    const match = command.match(/move_backward\((\d+)\)/);
                    if (match) {
                        unit.y += parseInt(match[1]);
                    }
                }
                else if (command.startsWith('move_left(')) {
                    const match = command.match(/move_left\((\d+)\)/);
                    if (match) {
                        unit.x -= parseInt(match[1]);
                    }
                }
                else if (command.startsWith('move_right(')) {
                    const match = command.match(/move_right\((\d+)\)/);
                    if (match) {
                        unit.x += parseInt(match[1]);
                    }
                }
                else if (command === 'attack()') {
                    // –ü–æ–∏—Å–∫ –≤—Ä–∞–≥–∞ –≤ —Ä–∞–¥–∏—É—Å–µ –∞—Ç–∞–∫–∏
                    let enemyInRange = null;
                    for (const enemy of enemies) {
                        if (enemy.alive) {
                            const dist = Math.sqrt((enemy.x - unit.x) ** 2 + (enemy.y - unit.y) ** 2);
                            if (dist <= unit.attackRange) {
                                enemyInRange = enemy;
                                break;
                            }
                        }
                    }
                    
                    if (enemyInRange) {
                        enemyInRange.health -= 50;
                        if (enemyInRange.health <= 0) {
                            enemyInRange.alive = false;
                            enemiesDefeated++;
                        }
                        
                        // –í–∏–∑—É–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç –∞—Ç–∞–∫–∏
                        ctx.fillStyle = '#ff5252';
                        ctx.font = 'bold 24px Arial';
                        ctx.textAlign = 'center';
                        ctx.fillText('‚öîÔ∏è', enemyInRange.x, enemyInRange.y - 50);
                    }
                }
                
                // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≥—Ä–∞–Ω–∏—Ü
                unit.x = Math.max(25, Math.min(775, unit.x));
                unit.y = Math.max(25, Math.min(775, unit.y));
                
                index++;
                setTimeout(executeNextCommand, 500);
            }
            
            executeNextCommand();
        }

        function completeLevel() {
            alert('üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –£—Ä–æ–≤–µ–Ω—å 2 –ø—Ä–æ–π–¥–µ–Ω!');
            
            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
            const levelsProgress = JSON.parse(localStorage.getItem('fortressBattleLevels') || '{}');
            levelsProgress['2'] = { completed: true, unlocked: true };
            levelsProgress['3'] = { completed: false, unlocked: true };
            localStorage.setItem('fortressBattleLevels', JSON.stringify(levelsProgress));
            
            // –í–æ–∑–≤—Ä–∞—Ç –∫ –≤—ã–±–æ—Ä—É —É—Ä–æ–≤–Ω–µ–π
            setTimeout(() => {
                window.location.href = 'levels.html';
            }, 2000);
        }

        function resetLevel() {
            unit.x = 100;
            unit.y = 100;
            unit.isMoving = false;
            unit.commands = [];
            
            enemies = [
                { x: 300, y: 200, health: 100, alive: true },
                { x: 500, y: 300, health: 100, alive: true },
                { x: 200, y: 500, health: 100, alive: true }
            ];
            
            enemiesDefeated = 0;
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        document.getElementById('run-code').addEventListener('click', executeCommands);
        document.getElementById('reset-level').addEventListener('click', resetLevel);

        // –ò–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
        function gameLoop() {
            renderLevel();
            requestAnimationFrame(gameLoop);
        }

        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
        gameLoop();
    </script>
</body>
</html>
